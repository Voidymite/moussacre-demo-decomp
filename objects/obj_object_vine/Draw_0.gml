var action1_tap;

if (!gamepad_is_connected(0))
{
    action1_tap = keyboard_check_pressed(global.action1) || mouse_check_button_pressed(global.action1);
    
    if (global.action1 == 1)
        action1_tap = mouse_check_button_pressed(global.action1);
}
else
{
    action1_tap = gamepad_button_check_pressed(0, global.c_action1) || keyboard_check_pressed(global.action1) || mouse_check_button_pressed(global.action1);
    
    if (global.action1 == 1)
        action1_tap = mouse_check_button_pressed(global.action1) || gamepad_button_check_pressed(0, global.c_action1);
}

draw_self();
frame = image_index;
draw_sprite_ext(spr_object_vine_tip, frame, x, y + 1000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 1000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 2000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 3000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 4000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 5000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 6000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 7000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 8000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 9000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 10000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 11000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 12000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 13000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 14000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 15000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 16000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 17000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 18000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 19000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 20000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 21000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 22000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 23000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 24000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 25000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 26000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 27000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 28000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 29000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 30000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 31000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 32000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 33000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 34000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 35000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 36000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 37000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 38000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 39000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 40000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 41000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 42000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 43000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 44000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 45000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 46000, image_xscale, image_yscale, 0, c_white, 1);
draw_sprite_ext(spr_object_vine_body, frame, x, y - 47000, image_xscale, image_yscale, 0, c_white, 1);

if (place_meeting(x, y, obj_mick) && active == 0)
{
    if (obj_mick.vspd <= 0)
        spd = obj_mick.vspd * -1;
    
    active = 1;
    audio_play_sound(snd_object_vine, 1, 0);
    
    with (obj_mick)
    {
        astate = 9;
        vspd = 0;
    }
}

if (active == 1 && !place_meeting(x, y, obj_object_vine_dontgrab))
{
    if (global.hp > 0)
    {
        obj_mick.x = x;
        obj_mick.y = y + 1200;
    }
    else
    {
        obj_mick.x = -10000;
        obj_mick.y = -10000;
    }
    
    with (obj_mick)
    {
        global.hspd = 0;
        jump_used = 0;
        stalled = 0;
        
        if (global.badge != 1)
            djump = 0;
        else
            djump = -1;
        
        djump_time = 1;
        c_time = 10;
        
        if (astate != 1 && astate != 2 && astate != 3 && astate != 5 && astate != 10 && astate != 11 && astate != 12 && !action1_tap)
            astate = 9;
    }
    
    if (obj_mick.astate != 9)
        active = 2;
}

if (place_meeting(x, y, obj_object_vine_dontgrab))
{
    active = 2;
    
    with (obj_mick)
    {
        if (astate == 9)
            astate = 0;
    }
}

if (active == 1)
{
    if (spd < 50)
        spd += 2;
    
    y -= spd;
}

if (active == 2)
{
    spd += 10;
    y -= spd;
    time--;
    
    if (time == 0)
    {
        active = 0;
        x = x_pos;
        y = y_pos;
        time = 30;
        image_xscale = 0;
        spd = 0;
    }
}

if (image_xscale < 1)
    image_xscale += 0.2;

if (active == 0)
{
    draw_sprite_ext(spr_object_vine_shine, 0, x, y + 1100, image_xscale * 0.8, image_yscale * 0.8, shine1, c_white, 1);
    draw_sprite_ext(spr_object_vine_shine, 0, x, y + 1100, image_xscale * 0.6, image_yscale * 0.6, shine2, c_white, 1);
}

shine1 += 5;
shine2 -= 10;

if (shine1 >= 360)
    shine1 = 0;

if (shine2 <= -360)
    shine2 = 0;
